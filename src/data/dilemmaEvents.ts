// æŠ‰æ‹©äº‹ä»¶ï¼ˆäºŒé€‰ä¸€ï¼‰â€” æš—é»‘èµ„æœ¬å®¶ç‰ˆ
// é€‰é¡¹ä¸æ˜¯"å¯¹ä¸é”™"ï¼Œè€Œæ˜¯"å†·è¡€åœ°è·åˆ©" vs "æ›´å†·è¡€åœ°è·åˆ©"
import type { GameState, DilemmaEvent } from '@/lib/types';

export const dilemmaEvents: DilemmaEvent[] = [
  {
    id: 'snitch_or_profit',
    title: 'çº¿äººè¿˜æ˜¯åŒä¼™',
    description: 'ä½ å‘ç°ä¸€ä¸ªå·¥å‹åœ¨å·å·ç”¨è€æ¿çš„è½¦æ‹‰ç§æ´»èµšé’±ã€‚ä¸¾æŠ¥ä»–èƒ½å¾—åˆ°è€æ¿çš„å¥–é‡‘ã€‚ä¸ä¸¾æŠ¥ï¼Œä»–ç­”åº”åˆ†ä½ ä¸€æ¯ç¾¹ã€‚',
    icon: 'ğŸ',
    minRound: 3,
    optionA: {
      text: 'ä¸¾æŠ¥ä»–',
      description: 'æ‹¿$1000å¥–é‡‘ï¼Œä»–è¢«å¼€é™¤',
      effects: { money: 1000, influence: 5 },
      successChance: 0.9,
      successText: 'ä»–è¢«ç‚’äº†ã€‚æ”¶æ‹¾ä¸œè¥¿çš„æ—¶å€™å›å¤´çœ‹äº†ä½ ä¸€çœ¼ã€‚ä½ å‡è£…åœ¨çœ‹æ‰‹æœºã€‚$1000åˆ°æ‰‹ã€‚',
      failText: 'è€æ¿è§‰å¾—ä½ åœ¨æäº‹ï¼Œä¸¤ä¸ªäººéƒ½è¢«è­¦å‘Šäº†ã€‚',
      failEffects: { san: -15 },
    },
    optionB: {
      text: 'åˆ†ä¸€æ¯ç¾¹',
      description: 'æ¯æœˆåˆ†ä½ $300ï¼Œä½†æœ‰é£é™©',
      effects: { money: 300, san: -3 },
      successText: 'ä½ ä»¬è¾¾æˆäº†é»˜å¥‘ã€‚ä»–æ¯æœˆç»™ä½ $300å°å£è´¹ã€‚åœ¨è¿™é‡Œï¼Œæ²‰é»˜æ˜¯æœ€å€¼é’±çš„å•†å“ã€‚',
    },
  },
  {
    id: 'exploit_newcomer',
    title: 'æ–°éŸ­èœæ¥äº†',
    description: 'ä¸€ä¸ªåˆšæ¥çš„å·æ¸¡å®¢ä¸æ‡‚è¡Œæƒ…ï¼Œä½ å¯ä»¥"å¸®"ä»–æ‰¾å·¥ä½œâ€”â€”ä»ä¸­æŠ½ä½£$2000ã€‚æˆ–è€…å®è¯å®è¯´ï¼Œäº¤ä¸ªæœ‹å‹ã€‚',
    icon: 'ğŸª´',
    minRound: 4,
    optionA: {
      text: 'åƒä¸­ä»‹è´¹',
      description: 'æŠ½$2000ä½£é‡‘ï¼Œä»–ä¸ä¼šçŸ¥é“å¸‚åœºä»·',
      effects: { money: 2000 },
      successChance: 0.85,
      successText: 'ä»–æ„Ÿæ¿€æ¶•é›¶åœ°å«ä½ "å¤§å“¥"ã€‚ä»–ä¸çŸ¥é“é‚£ä»½å·¥ä½œæ ¹æœ¬ä¸éœ€è¦ä¸­ä»‹è´¹ã€‚$2000åˆ°æ‰‹ã€‚',
      failText: 'ä»–åæ¥ä»åˆ«äººé‚£é‡ŒçŸ¥é“äº†çœŸç›¸ï¼Œåœ¨åäººç¾¤é‡ŒæŠŠä½ éª‚äº†ä¸€é€šã€‚',
      failEffects: { money: 2000, influence: -10, san: -5 },
    },
    optionB: {
      text: 'äº¤ä¸ªæœ‹å‹',
      description: 'å…è´¹å¸®ä»–ï¼Œç§¯ç´¯äººè„‰',
      effects: { influence: 8, san: 5 },
      successText: 'ä½ å¸®äº†ä»–ã€‚ä¸‰ä¸ªæœˆåä»–æˆäº†ä½ æœ€å¿ å®çš„æ‰‹ä¸‹ã€‚æœ‰æ—¶å€™æŠ•èµ„äººå¿ƒæ¯”æŠ•èµ„è‚¡ç¥¨å›æŠ¥ç‡æ›´é«˜ã€‚',
    },
  },
  {
    id: 'buy_distress',
    title: 'è¶ç«æ‰“åŠ«',
    description: 'ä¸€ä¸ªåäººè€æ¿æ€¥ç€è·‘è·¯ï¼Œä»–çš„å°é¤é¦†ä»·å€¼$20,000ï¼Œä½†ä»–åªè¦$5,000å°±å–ã€‚ä»–æ€¥å¾—æ»¡å¤´å¤§æ±—ã€‚',
    icon: 'ğŸ”¥',
    minRound: 6,
    condition: (s) => s.money >= 5000,
    optionA: {
      text: 'å‹ä»·åˆ°$3,000',
      description: 'ä»–å·²ç»èµ°æŠ•æ— è·¯äº†ï¼Œä½ å¯ä»¥å‹å¾—æ›´ä½',
      effects: { money: -3000 },
      successChance: 0.7,
      successText: 'ä»–å«ç€æ³ªç­¾äº†åˆåŒã€‚ä½ ç”¨$3,000ä¹°äº†ä»·å€¼$20,000çš„èµ„äº§ã€‚è¿™å°±æ˜¯èµ„æœ¬ä¸»ä¹‰ã€‚',
      failText: 'ä»–å—ä¸äº†ä¾®è¾±ï¼Œå®å¯çƒ§äº†ä¹Ÿä¸å–ç»™ä½ ã€‚ä½ ä»€ä¹ˆéƒ½æ²¡å¾—åˆ°ï¼Œè¿˜æµªè´¹äº†æ—¶é—´ã€‚',
      failEffects: { san: -5 },
    },
    optionB: {
      text: 'æŒ‰$5,000ä¹°',
      description: 'ä¸ç®—è¶ç«æ‰“åŠ«ï¼Œä½†ä¾ç„¶æ˜¯ä¸ªæš´åˆ©äº¤æ˜“',
      effects: { money: -5000, influence: 3 },
      successText: 'ä½ ç”¨$5,000æ¥æ‰‹äº†ä»–çš„åº—ã€‚ä»–ä¸´èµ°å‰æ¡ç€ä½ çš„æ‰‹è¯´è°¢è°¢ã€‚ä½ åœ¨å¿ƒé‡Œç®—ç€å›æœ¬çš„å¤©æ•°ã€‚',
    },
  },
  {
    id: 'protection_racket',
    title: 'ä¿æŠ¤è´¹ç”Ÿæ„',
    description: 'ä½ åœ¨è¿™ä¸ªåŒºåŸŸå·²ç»æœ‰äº†ä¸€å®šå½±å“åŠ›ã€‚æœ‰äººæè®®ä½ ä¸€èµ·"ä¿æŠ¤"æ–°æ¥çš„å•†æˆ·â€”â€”æ¯å®¶æ¯æœˆæ”¶$200ã€‚',
    icon: 'ğŸ”’',
    minRound: 8,
    condition: (s) => s.education.influence >= 30,
    optionA: {
      text: 'å…¥ä¼™',
      description: 'æ¯æœˆé¢å¤–æ”¶å…¥$800ï¼Œä½†è¦è¸è¿›ç°è‰²åœ°å¸¦',
      effects: { money: 800, san: -15, influence: 5 },
      successChance: 0.8,
      successText: 'ä½ æˆäº†"ä¿æŠ¤"å››å®¶å•†æˆ·çš„äººã€‚ä»–ä»¬æŒ‰æ—¶äº¤é’±ã€‚ææƒ§æ˜¯æœ€å¥½çš„å•†ä¸šæ¨¡å¼ã€‚',
      failText: 'æœ‰ä¸ªå€”å¼ºçš„å•†æˆ·æŠ¥äº†è­¦ã€‚ä½ å·®ç‚¹è¢«æŠ“è¿›å»ï¼Œå“å‡ºä¸€èº«å†·æ±—ã€‚',
      failEffects: { money: -500, san: -25, credit: -30 },
    },
    optionB: {
      text: 'æ‹’ç»',
      description: 'ä¸ç¢°è¿™æ¡çº¿',
      effects: { san: 5 },
      successText: 'ä½ æ‘‡äº†æ‘‡å¤´ã€‚æœ‰äº›é’±å¤ªè„äº†â€”â€”ä¸æ˜¯å› ä¸ºè‰¯å¿ƒï¼Œè€Œæ˜¯å› ä¸ºé£é™©å›æŠ¥æ¯”ä¸å¤Ÿé«˜ã€‚',
    },
  },
  {
    id: 'labor_exploit',
    title: 'ä¾¿å®œåŠ³åŠ¨åŠ›',
    description: 'ä½ æ‰‹ä¸‹éœ€è¦äººå¹²æ´»ã€‚ä¸€ä¸ªèµ°æŠ•æ— è·¯çš„åŒèƒæ„¿æ„ä¸º$5/æ—¶å·¥ä½œâ€”â€”å¸‚åœºä»·æ˜¯$15ã€‚ä½ æ€ä¹ˆé€‰ï¼Ÿ',
    icon: 'â›“ï¸',
    minRound: 5,
    condition: (s) => s.money >= 3000,
    optionA: {
      text: 'å°±ç»™$5',
      description: 'ä»–æ²¡å¾—é€‰ï¼Œä½ çœäº†ä¸€å¤§ç¬”',
      effects: { money: 1500, san: -10 },
      successChance: 1,
      successText: 'ä»–ä½ç€å¤´æ¥å—äº†ã€‚ä½ æ¯ä¸ªæœˆçœäº†$1500ã€‚è¿™å°±æ˜¯ä¾›æ±‚å…³ç³»â€”â€”ä»–çš„ç»æœ›æ˜¯ä½ çš„æŠ˜æ‰£ã€‚',
    },
    optionB: {
      text: 'ç»™$10',
      description: 'æ¯”å¸‚åœºä»·ä½ä½†ä¸ç®—å¤ªç¦»è°±',
      effects: { money: 700, san: 3, influence: 3 },
      successText: 'ä½ ç»™äº†$10ã€‚ä»–æ„Ÿæ¿€ä¸å·²ã€‚ä½ ä¸æ˜¯å¥½äººâ€”â€”ä½ åªæ˜¯åœ¨æŠ•èµ„å¿ è¯šåº¦ã€‚',
    },
  },
  {
    id: 'insurance_fraud',
    title: 'ä¿é™©è¯ˆéª—',
    description: 'æœ‰äººæ•™ä½ ä¸€ä¸ª"å¿«é€Ÿèµšé’±"çš„æ–¹æ³•ï¼šå‡è£…åœ¨è¶…å¸‚æ‘”å€’ï¼Œç„¶åç´¢èµ”$10,000ã€‚',
    icon: 'ğŸ¤•',
    minRound: 7,
    optionA: {
      text: 'æ¼”ä¸€å‡ºæˆ',
      description: 'å¯èƒ½èµš$10,000ï¼Œä½†æœ‰40%æ¦‚ç‡è¢«è¯†ç ´',
      effects: { money: 10000 },
      successChance: 0.6,
      successText: 'å¥¥æ–¯å¡æ¬ ä½ ä¸€åº§å°é‡‘äººã€‚$10,000åˆ°è´¦ã€‚åœ¨ç¾å›½ï¼Œè¯šå®æ˜¯å¥¢ä¾ˆå“ã€‚',
      failText: 'è¢«ç›‘æ§æ‹åˆ°äº†ã€‚ç½šæ¬¾$3,000ï¼Œä¿¡ç”¨è®°å½•ç•™äº†ä¸€ç¬”ã€‚',
      failEffects: { money: -3000, credit: -40, san: -15 },
    },
    optionB: {
      text: 'ç®—äº†',
      description: 'é£é™©å¤ªé«˜',
      effects: { san: 3 },
      successText: 'ä½ æ²¡å»ã€‚ä¸æ˜¯å› ä¸ºé“å¾·ï¼Œè€Œæ˜¯å› ä¸ºä½ ç®—äº†ä¸€ä¸‹æœŸæœ›å€¼â€”â€”ä¸å¤Ÿé«˜ã€‚',
    },
  },
  {
    id: 'sell_info',
    title: 'å–æƒ…æŠ¥',
    description: 'æœ‰äººå‡º$3,000ä¹°ä½ æ‰‹é‡Œçš„ä¸€ä»½åå•â€”â€”ä¸Šé¢æ˜¯ä½ è®¤è¯†çš„æ‰€æœ‰æ— è¯ç§»æ°‘çš„ä½å€å’Œå·¥ä½œåœ°ç‚¹ã€‚ä½ çŸ¥é“è¿™ä»½åå•ä¼šæµå‘å“ªé‡Œã€‚',
    icon: 'ğŸ“‹',
    minRound: 10,
    condition: (s) => s.education.influence >= 20,
    optionA: {
      text: 'å–',
      description: '$3,000ã€‚ä»–ä»¬çš„å‘½è¿ä¸å…³ä½ çš„äº‹ã€‚',
      effects: { money: 3000, san: -25 },
      successChance: 1,
      successText: 'é’±åˆ°æ‰‹äº†ã€‚ä½ åˆ æ‰äº†å¯¹æ–¹çš„è”ç³»æ–¹å¼ã€‚ä¸€ä¸ªæœˆåä½ å¬è¯´é‚£ä¸ªç¤¾åŒºè¢«æ¸…æ‰«äº†ã€‚ä½ ä»€ä¹ˆéƒ½æ²¡æƒ³ã€‚',
    },
    optionB: {
      text: 'ä¸å–',
      description: 'è¿™æ¡çº¿ä¸èƒ½è¶Š',
      effects: { san: 10 },
      successText: 'ä½ æ‹’ç»äº†ã€‚æœ‰äº›é’±èµšäº†ä¼šè®©ä½ åœ¨åŠå¤œé†’æ¥â€”â€”ä¸æ˜¯å› ä¸ºè‰¯å¿ƒï¼Œè€Œæ˜¯å› ä¸ºææƒ§ã€‚ä¸‡ä¸€åå•ä¸Šçš„äººæ‰¾åˆ°ä½ å‘¢ï¼Ÿ',
    },
  },
  {
    id: 'kick_down',
    title: 'è½äº•ä¸‹çŸ³',
    description: 'ä½ ä¹‹å‰çš„ç«äº‰å¯¹æ‰‹ç ´äº§äº†ï¼Œæ¬ äº†ä½ $2,000ã€‚ä»–è·ªåœ¨ä½ é¢å‰æ±‚ä½ å®½é™å‡ ä¸ªæœˆã€‚ä½ å¯ä»¥å…äº†ä»–çš„å€ºâ€”â€”æˆ–è€…å¤ºèµ°ä»–æœ€åçš„è´¢äº§ã€‚',
    icon: 'ğŸ‘¢',
    minRound: 12,
    condition: (s) => s.money >= 10000,
    optionA: {
      text: 'å…¨éƒ¨æ‹¿èµ°',
      description: 'æ¬ç©ºä»–çš„ä¸œè¥¿ï¼Œå€¼$4,000',
      effects: { money: 4000, san: -20, influence: -5 },
      successChance: 1,
      successText: 'ä½ å¸¦äººæ¬ç©ºäº†ä»–çš„ä½å¤„ã€‚ä»–ååœ¨ç©ºè¡è¡çš„æˆ¿é—´é‡Œå‘å‘†ã€‚ä½ å›åˆ°è‡ªå·±çš„è±ªå®…é‡Œå€’äº†æ¯é…’ã€‚',
    },
    optionB: {
      text: 'å…äº†',
      description: 'æ”¾ä»–ä¸€é©¬ï¼Œä¼ å‡ºå»æ˜¯"å¤§å“¥å¤§"çš„æ°”åº¦',
      effects: { money: -2000, influence: 15, san: 10 },
      successText: 'ä½ å¤§æ‰‹ä¸€æŒ¥å…äº†ä»–çš„å€ºã€‚æ¶ˆæ¯ä¼ å¼€äº†â€”â€”æ‰€æœ‰äººéƒ½è¯´ä½ æ˜¯"æœ‰æ ¼å±€çš„äºº"ã€‚è¿™ç¬”æŠ•èµ„å›æŠ¥ç‡ä¸é”™ã€‚',
    },
  },
];

/**
 * æš—é»‘ç‰ˆæŠ‰æ‹©äº‹ä»¶è§¦å‘
 * æ¦‚ç‡çº¦ 30%
 */
export function rollDilemma(state: GameState): DilemmaEvent | null {
  if (Math.random() > 0.30) return null;

  const eligible = dilemmaEvents.filter(d => {
    if (d.minRound && state.currentRound < d.minRound) return false;
    if (d.condition) {
      try {
        if (!d.condition(state)) return false;
      } catch {
        return false;
      }
    }
    return true;
  });

  if (eligible.length === 0) return null;

  const idx = Math.floor(Math.random() * eligible.length);
  return eligible[idx];
}
